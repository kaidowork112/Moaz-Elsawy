<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لوحة الأدمن | Moaz Elsawy</title>
<link rel="stylesheet" href="style.css">
<style>
.admin-container{padding:40px}
.admin-container h2{color:#0a74da;text-align:center;margin-bottom:30px}
.property-form input, .property-form textarea{width:100%;padding:10px;margin:5px 0;border:1px solid #ccc;border-radius:6px}
.property-form button{background:#0a74da;color:white;padding:10px 20px;border:none;border-radius:6px;cursor:pointer}
.property-form button:hover{background:#005bb5;color:white}
.property-list-admin{margin-top:30px}
.property-card-admin{background:white;padding:15px;border-radius:10px;margin-bottom:10px;box-shadow:0 3px 10px rgba(0,0,0,0.1);display:flex;justify-content:space-between;align-items:center}
.property-card-admin button{margin-left:10px}
</style>
</head>
<body>
<div class="admin-container">
<h2>لوحة الأدمن</h2>
<form id="addPropertyForm" class="property-form">
<input type="text" id="propTitle" placeholder="عنوان العقار" required>
<input type="text" id="propLocation" placeholder="الموقع" required>
<input type="text" id="propPrice" placeholder="السعر" required>
<input type="text" id="propType" placeholder="النوع">
<input type="number" id="propRooms" placeholder="عدد الغرف">
<textarea id="propDesc" placeholder="الوصف"></textarea>
<input type="text" id="propImg" placeholder="رابط الصورة">
<button type="submit">إضافة عقار</button>
</form>

<div id="propertyList" class="property-list-admin"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getFirestore, collection, doc, setDoc, getDocs, deleteDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBxEWaPWqpUIgZtasxnE7-82SN6OEzSx7Q",
  authDomain: "moaz-elsawy.firebaseapp.com",
  projectId: "moaz-elsawy",
  storageBucket: "moaz-elsawy.firebasestorage.app",
  messagingSenderId: "859568017117",
  appId: "1:859568017117:web:38a7d0c96532f0f7681534",
  measurementId: "G-JY1XN1VRCP"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function protectAdminPage(){
  const user = JSON.parse(localStorage.getItem('realestate_user')||'{}');
  if(!user.is_admin){ alert("يجب تسجيل الدخول كأدمن"); window.location.href="login.html"; }
}
protectAdminPage();

const propertyListDiv = document.getElementById("propertyList");
const addForm = document.getElementById("addPropertyForm");

async function loadProperties(){
  const querySnapshot = await getDocs(collection(db,"properties"));
  propertyListDiv.innerHTML="";
  querySnapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const card = document.createElement("div");
    card.className="property-card-admin";
    card.innerHTML=`<span>${data.title} - ${data.city||data.location||''} - ${data.price}</span>
    <div>
    <button onclick='deleteProperty("${docSnap.id}")'>مسح</button>
    </div>`;
    propertyListDiv.appendChild(card);
  });
}
window.deleteProperty = async function(id){
  await deleteDoc(doc(db,"properties",id));
  loadProperties();
}

addForm.addEventListener("submit", async e=>{
  e.preventDefault();
  const id = Date.now().toString();
  const newProp = {
    title: document.getElementById("propTitle").value,
    location: document.getElementById("propLocation").value,
    price: document.getElementById("propPrice").value,
    type: document.getElementById("propType").value,
    rooms: document.getElementById("propRooms").value,
    desc: document.getElementById("propDesc").value,
    img: document.getElementById("propImg").value
  };
  await setDoc(doc(db,"properties",id),newProp);
  addForm.reset();
  loadProperties();
});

loadProperties();
</script>
</body>
</html>
