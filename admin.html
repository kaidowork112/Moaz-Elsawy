<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ููุญุฉ ุงูุฃุฏูู - Moaz Elsawy</title>
<link rel="stylesheet" href="style.css" />
<style>
  /* ูููู ุฅุถุงูุฉ ุฃููุงุท ุงูุฌุฏูู ููุง ูู ุงูุณุงุจู */
</style>
</head>
<body>
<header>
  <div class="logo">๐ ููุญุฉ ุงูุฃุฏูู</div>
  <button id="logout">ุฎุฑูุฌ</button>
</header>

<main class="container">
  <h2>ูุงุฆูุฉ ุงูุนูุงุฑุงุช ุงูููุดูุฑุฉ</h2>
  <table id="adminTable" border="1" width="100%" cellspacing="0" cellpadding="8">
    <thead>
      <tr>
        <th>ุงูุนููุงู</th>
        <th>ุงูุณุนุฑ</th>
        <th>ุงูุบุฑู</th>
        <th>ุงููุฏููุฉ</th>
        <th>ุฅุฌุฑุงุกุงุช</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
  <button id="addBtn">ุฅุถุงูุฉ ุนูุงุฑ ุฌุฏูุฏ</button>
</main>

<div id="modal" style="display:none;">
  <!-- ููููู ุฅุถุงูุฉ ูุงูุฐุฉ ููุจุซูุฉ ููุฅุถุงูุฉ/ุงูุชุนุฏูู -->
</div>

<script>
const GITHUB_OWNER = 'kaidowork112';
const GITHUB_REPO = 'Moaz-Elsawy';
const PROPERTIES_FILE = 'data/properties.json';
const BRANCH = 'main';
const TOKEN = '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';

let properties = [], currentSHA = '';

const user = JSON.parse(localStorage.getItem('realestate_user')||'{}');
if(!user.is_admin){ alert('ุบูุฑ ูุณููุญุ ุณุฌู ุงูุฏุฎูู ูุฃุฏูู'); window.location.href='login-register.html'; }

document.getElementById('logout').onclick = () => { localStorage.removeItem('realestate_user'); location.href='login-register.html'; };

async function fetchProperties(){
    const res = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${PROPERTIES_FILE}?ref=${BRANCH}`, {
        headers: { Authorization:`token ${TOKEN}` }
    });
    const data = await res.json();
    currentSHA = data.sha;
    const content = atob(data.content);
    properties = JSON.parse(content);
    displayTable();
}

function displayTable(){
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    properties.forEach(prop=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${prop.title}</td>
            <td>${prop.price}</td>
            <td>${prop.rooms || ''}</td>
            <td>${prop.city || prop.location || ''}</td>
            <td>
                <button onclick="editProp(${prop.id})">ุชุนุฏูู</button>
                <button onclick="deleteProp(${prop.id})">ุญุฐู</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

async function updateProperties(commitMsg){
    const res = await fetch(`https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${PROPERTIES_FILE}`,{
        method:'PUT',
        headers:{ Authorization:`token ${TOKEN}`, 'Content-Type':'application/json'},
        body:JSON.stringify({
            message: commitMsg,
            content: btoa(JSON.stringify(properties,null,2)),
            sha: currentSHA,
            branch: BRANCH
        })
    });
    const data = await res.json();
    if(data.content){ currentSHA = data.content.sha; fetchProperties(); alert('ุชู ุงูุญูุธ โ'); }
}

function deleteProp(id){
    if(!confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุนูุงุฑุ')) return;
    properties = properties.filter(p=>p.id!==id);
    updateProperties(`ุญุฐู ุงูุนูุงุฑ ID: ${id}`);
}

function editProp(id){
    // ููุง ูููู ูุชุญ ูุงูุฐุฉ ููุจุซูุฉ ูุชุนุฏูู ุงูุจูุงูุงุช ุซู updateProperties
    alert('ูุธููุฉ ุงูุชุนุฏูู ูููู ุฅุถุงูุชูุง ุญุณุจ ุงูุชุตููู ุงูุณุงุจู');
}

document.getElementById('addBtn').onclick = ()=>{
    // ููุง ูููู ูุชุญ ูุงูุฐุฉ ููุจุซูุฉ ููุฅุถุงูุฉ ุซู updateProperties
    alert('ูุธููุฉ ุงูุฅุถุงูุฉ ูููู ุฅุถุงูุชูุง ุญุณุจ ุงูุชุตููู ุงูุณุงุจู');
};

fetchProperties();
</script>
</body>
</html>
