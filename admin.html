<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ØµÙØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #222;
    }
    form {
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 25px;
    }
    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    label { font-size: 14px; color: #333; }
    button {
      background-color: #0078d4;
      color: #fff;
      border: none;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background-color: #005ea3; }
    .post {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 15px;
      margin-bottom: 10px;
    }
    .post img {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .controls button {
      margin-left: 5px;
      background: #e33;
    }
    .controls button:first-child {
      background: #28a745;
    }
  </style>
</head>
<body>

<h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</h1>

<form id="postForm">
  <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù‚Ø§Ø±</label>
  <input type="text" id="title" required>

  <label>Ø§Ù„ÙˆØµÙ</label>
  <textarea id="description" required></textarea>

  <label>Ø§Ù„Ù†ÙˆØ¹</label>
  <select id="type">
    <option value="Ø´Ù‚Ø©">Ø´Ù‚Ø©</option>
    <option value="ÙÙŠÙ„Ø§">ÙÙŠÙ„Ø§</option>
  </select>

  <label>Ø§Ù„Ù…Ø³Ø§Ø­Ø© (Ù…Â²)</label>
  <input type="number" id="area" required>

  <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
  <input type="text" id="location">

  <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©</label>
  <input type="url" id="image" required>

  <label>
    <input type="checkbox" id="slider"> Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø§ÙŠØ¯Ø±
  </label>

  <button type="submit">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø±</button>
</form>

<div id="postsContainer"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBxEWaPWqpUIgZtasxnE7-82SN6OEzSx7Q",
    authDomain: "moaz-elsawy.firebaseapp.com",
    projectId: "moaz-elsawy",
    storageBucket: "moaz-elsawy.firebasestorage.app",
    messagingSenderId: "859568017117",
    appId: "1:859568017117:web:38a7d0c96532f0f7681534",
    measurementId: "G-JY1XN1VRCP"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const postForm = document.getElementById("postForm");
  const postsContainer = document.getElementById("postsContainer");

  // Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø´ÙˆØ± Ø¬Ø¯ÙŠØ¯
  postForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    const newPost = {
      title: title.value,
      description: description.value,
      type: type.value,
      area: area.value,
      location: location.value || "",
      image: image.value,
      inSlider: slider.checked,
      createdAt: new Date().toISOString()
    };
    await addDoc(collection(db, "posts"), newPost);
    alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù‚Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ âœ…");
    postForm.reset();
    loadPosts();
  });

  // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
  async function loadPosts() {
    postsContainer.innerHTML = "";
    const querySnapshot = await getDocs(collection(db, "posts"));
    querySnapshot.forEach((docu) => {
      const p = docu.data();
      const div = document.createElement("div");
      div.className = "post";
      div.innerHTML = `
        <img src="${p.image}" alt="${p.title}">
        <h3>${p.title}</h3>
        <p>${p.description}</p>
        <p>Ø§Ù„Ù†ÙˆØ¹: ${p.type} - Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${p.area} Ù…Â²</p>
        ${p.location ? `<p>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: ${p.location}</p>` : ""}
        <p>${p.inSlider ? "â­ ÙÙŠ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø±" : ""}</p>
        <div class="controls">
          <button onclick="editPost('${docu.id}')">ØªØ¹Ø¯ÙŠÙ„</button>
          <button onclick="deletePost('${docu.id}')">Ø­Ø°Ù</button>
        </div>
      `;
      postsContainer.appendChild(div);
    });
  }

  // ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†Ø´ÙˆØ±
  window.editPost = async (id) => {
    const newTitle = prompt("Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¬Ø¯ÙŠØ¯:");
    if (!newTitle) return;
    await updateDoc(doc(db, "posts", id), { title: newTitle });
    alert("ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ± âœ…");
    loadPosts();
  };

  // Ø­Ø°Ù Ù…Ù†Ø´ÙˆØ±
  window.deletePost = async (id) => {
    if (!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±ØŸ")) return;
    await deleteDoc(doc(db, "posts", id));
    alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ± âŒ");
    loadPosts();
  };

  loadPosts();
</script>
</body>
</html>
