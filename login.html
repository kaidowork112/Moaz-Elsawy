<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ | Moaz Elsawy</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #0a74da, #002b5b);
      font-family: "Cairo", sans-serif;
      overflow: hidden;
    }
    .container {
      position: relative;
      width: 380px;
      height: 520px;
      perspective: 1000px;
    }
    .login-box {
      position: absolute;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.4);
      transition: transform 0.8s;
      transform-style: preserve-3d;
    }
    .login-box.flipped {
      transform: rotateY(180deg);
    }
    form {
      position: absolute;
      width: 100%;
      height: 100%;
      padding: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      backface-visibility: hidden;
    }
    form h2 {
      color: #fff;
      text-align: center;
      margin-bottom: 25px;
      font-weight: 600;
    }
    input {
      margin: 10px 0;
      padding: 12px;
      border: none;
      border-radius: 8px;
      outline: none;
      background: rgba(255, 255, 255, 0.85);
      font-size: 16px;
    }
    button {
      margin-top: 15px;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: #f5b800;
      font-weight: bold;
      cursor: pointer;
      font-size: 16px;
      transition: 0.3s;
    }
    button:hover {
      background: #ffcc33;
    }
    .switch {
      text-align: center;
      margin-top: 15px;
      color: #fff;
      cursor: pointer;
      text-decoration: underline;
    }
    .register-form {
      transform: rotateY(180deg);
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="login-box">
      <!-- Login -->
      <form id="loginForm">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <input type="email" name="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required />
        <input type="password" name="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required />
        <button type="submit">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
        <div id="switchToRegister" class="switch">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</div>
      </form>

      <!-- Register -->
      <form id="registerForm" class="register-form">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</h2>
        <input type="text" name="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required />
        <input type="text" name="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (11 Ø±Ù‚Ù…)" pattern="[0-9]{11}" required />
        <input type="email" name="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" required />
        <input type="password" name="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required />
        <button type="submit">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        <div id="switchToLogin" class="switch">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù„ÙØ¹Ù„ØŸ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
      </form>
    </div>
  </div>

  <script type="module">
    // ============ Firebase ============
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBxEWaPWqpUIgZtasxnE7-82SN6OEzSx7Q",
      authDomain: "moaz-elsawy.firebaseapp.com",
      projectId: "moaz-elsawy",
      storageBucket: "moaz-elsawy.firebasestorage.app",
      messagingSenderId: "859568017117",
      appId: "1:859568017117:web:38a7d0c96532f0f7681534",
      measurementId: "G-JY1XN1VRCP"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const loginForm = document.getElementById("loginForm");
    const registerForm = document.getElementById("registerForm");
    const switchToRegister = document.getElementById("switchToRegister");
    const switchToLogin = document.getElementById("switchToLogin");

    switchToRegister.addEventListener("click", () => {
      document.querySelector(".login-box").classList.add("flipped");
    });
    switchToLogin.addEventListener("click", () => {
      document.querySelector(".login-box").classList.remove("flipped");
    });

    // ============ Register ============
    registerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = e.target.name.value.trim();
      const phone = e.target.phone.value.trim();
      const email = e.target.email.value.trim();
      const password = e.target.password.value.trim();

      if (!name || !phone || !email || !password) {
        alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.");
        return;
      }

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        await updateProfile(user, { displayName: name });

        // Ø£Ø¶Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        await setDoc(doc(db, "users", user.uid), {
          name,
          phone,
          email,
          isAdmin: false,
          createdAt: new Date().toISOString(),
        });

        localStorage.setItem("user", JSON.stringify({ name, email, phone, isAdmin: false }));

        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
        window.location.href = "index.html";
      } catch (error) {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: " + error.message);
      }
    });

    // ============ Login ============
    loginForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = e.target.email.value.trim();
      const password = e.target.password.value.trim();

      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        // Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore
        const userDoc = await getDoc(doc(db, "users", user.uid));

        if (userDoc.exists()) {
          const userData = userDoc.data();
          localStorage.setItem("user", JSON.stringify(userData));

          if (userData.isAdmin) {
            alert("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ø£Ø¯Ù…Ù† ğŸ‘‘");
            window.location.href = "admin.html";
          } else {
            alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            window.location.href = "index.html";
          }
        } else {
          alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù….");
        }
      } catch (error) {
        alert("Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© âŒ");
      }
    });
  </script>
</body>
</html>
