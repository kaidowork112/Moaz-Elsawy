<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background: #fafafa;
      margin: 0;
      padding: 0;
    }
    header {
      background: #0078d4;
      color: #fff;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 {
      margin: 0;
      font-size: 22px;
    }
    header nav a {
      color: #fff;
      text-decoration: none;
      margin-left: 15px;
      background: rgba(255,255,255,0.2);
      padding: 6px 10px;
      border-radius: 6px;
      transition: 0.3s;
    }
    header nav a:hover {
      background: rgba(255,255,255,0.4);
    }

    #slider {
      display: flex;
      overflow-x: auto;
      scroll-behavior: smooth;
      gap: 15px;
      padding: 15px;
    }
    .slide {
      min-width: 300px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      transition: transform 0.3s;
      flex-shrink: 0;
    }
    .slide img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    .slide:hover { transform: scale(1.05); }

    #posts {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
      padding: 20px;
    }
    .post {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 10px;
    }
    .post img {
      width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<header>
  <h1>Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h1>
  <nav>
    <a id="adminBtn" href="admin.html" style="display:none;">Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù†</a>
    <a id="loginBtn" href="login.html">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</a>
  </nav>
</header>

<section>
  <h2 style="padding:10px;">Ø¹Ù‚Ø§Ø±Ø§Øª Ù…Ù…ÙŠØ²Ø©</h2>
  <div id="slider"></div>
</section>

<h2 style="padding:10px;">ÙƒÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª</h2>
<div id="posts"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
  import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
  import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBxEWaPWqpUIgZtasxnE7-82SN6OEzSx7Q",
    authDomain: "moaz-elsawy.firebaseapp.com",
    projectId: "moaz-elsawy",
    storageBucket: "moaz-elsawy.firebasestorage.app",
    messagingSenderId: "859568017117",
    appId: "1:859568017117:web:38a7d0c96532f0f7681534",
    measurementId: "G-JY1XN1VRCP"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth(app);

  const slider = document.getElementById("slider");
  const postsDiv = document.getElementById("posts");
  const loginBtn = document.getElementById("loginBtn");
  const adminBtn = document.getElementById("adminBtn");

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
  async function loadPosts() {
    postsDiv.innerHTML = "";
    slider.innerHTML = "";
    const querySnapshot = await getDocs(collection(db, "posts"));
    querySnapshot.forEach((docu) => {
      const p = docu.data();
      const postHTML = `
        <div class="post">
          <img src="${p.image}" alt="${p.title}">
          <h3>${p.title}</h3>
          <p>${p.description}</p>
          <p>Ø§Ù„Ù†ÙˆØ¹: ${p.type} | Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${p.area} Ù…Â²</p>
          ${p.location ? `<p>ğŸ“ ${p.location}</p>` : ""}
        </div>
      `;
      postsDiv.innerHTML += postHTML;

      if (p.inSlider) {
        slider.innerHTML += `
          <div class="slide">
            <img src="${p.image}" alt="${p.title}">
            <div style="padding:10px;">
              <h3>${p.title}</h3>
            </div>
          </div>
        `;
      }
    });
  }

  // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  setInterval(() => {
    slider.scrollBy({ left: 320, behavior: "smooth" });
    if (slider.scrollLeft + slider.clientWidth >= slider.scrollWidth) {
      slider.scrollTo({ left: 0, behavior: "smooth" });
    }
  }, 3000);

  // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  onAuthStateChanged(auth, (user) => {
    if (user) {
      loginBtn.textContent = "ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬";
      loginBtn.href = "#";
      loginBtn.onclick = async () => {
        await signOut(auth);
        location.reload();
      };

      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ù‡ Ø£Ø¯Ù…Ù†
      if (user.email === "admin@moazelsawy.com") {
        adminBtn.style.display = "inline-block";
      } else {
        adminBtn.style.display = "none";
      }
    } else {
      loginBtn.textContent = "ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„";
      loginBtn.href = "login.html";
      adminBtn.style.display = "none";
    }
  });

  loadPosts();
</script>
</body>
</html>
